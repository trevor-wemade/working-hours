<!DOCTYPE html>
<html lang="ko">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HML9W3F9PG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-HML9W3F9PG');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ê·¼ë¬´ì‹œê°„ ê³„ì‚°ê¸° (ì‹œí”„í‹°ìš©)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f0f2f5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 5px; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
        .how-to-use-section { padding: 15px 30px; }
        .how-to-use-container {
            border: 1px solid #4CAF50;
            border-radius: 8px;
            background-color: #f8f9fa;
            overflow: hidden;
        }
        .how-to-use-toggle {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .how-to-use-content {
            padding: 20px;
            display: none;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        .main-content {
            padding: 30px;
            padding-top: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .input-section, .result-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }
        .section-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #34495e; font-size: 0.95em; }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
        }
        .textarea-large { height: 100px; resize: vertical; font-family: monospace; font-size: 12px !important; }
        .time-input { text-align: center; font-family: 'Courier New', monospace; font-weight: bold; }

        .btn-parse {
            background: linear-gradient(135deg, #FF6B6B 0%, #d32f2f 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.1s;
        }
        .btn-parse:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,107,107,0.4); }

        .result-table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; }
        .result-table th { background: #5c6bc0; color: white; padding: 10px; font-size: 0.9em; }
        .result-table td { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.95em; }
        .result-table tr:last-child td { border-bottom: none; }

        /* ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .highlight-row { background-color: #fff9c4 !important; border-top: 2px solid #fbc02d; }
        .highlight-row td { font-weight: bold; font-size: 1.05em; }

        .time-display { color: #2E7D32; font-weight: bold; font-family: 'Courier New', monospace; }
        .decimal-time { color: #888; font-size: 0.8em; margin-left: 5px; font-weight: normal; }

        .shortage-text { color: #d32f2f !important; font-weight: bold; }
        .excess-text { color: #388e3c !important; font-weight: bold; }
        .perfect-text { color: #1976D2 !important; font-weight: bold; }

        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .editable-input { background-color: #fff; border: 1px solid #bbb !important; color: #e65100; font-weight: 600; }
        .leave-control-container {
            background: white; border: 1px solid #ddd; padding: 10px; border-radius: 6px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .leave-control { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; }
        .counter { display: flex; align-items: center; gap: 8px; background: #f1f3f5; padding: 2px 8px; border-radius: 15px; }
        .counter-btn {
            width: 24px; height: 24px; border-radius: 50%; border: none; background: #4CAF50; color: white;
            font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center;
        }
        .status-info, .calendar-info {
            margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 0.9em;
        }
        .status-info { background: #e3f2fd; border-left: 4px solid #2196F3; }
        .calendar-info { background: #fff3e0; border-left: 4px solid #ff9800; }

        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>
<div class="container">
    <div class="header">
        <h1>ğŸ”¥ê·¼ë¬´ì‹œê°„ ê³„ì‚°ê¸°</h1>
    </div>

    <div class="how-to-use-section">
        <div class="how-to-use-container">
            <button id="toggleHowToUse" class="how-to-use-toggle">
                ğŸ’¡ ì‚¬ìš©ë°©ë²• <span class="toggle-arrow">â–¼</span>
            </button>
            <div id="howToUseContent" class="how-to-use-content">
                <p>
                    <strong>1. í…ìŠ¤íŠ¸ ë³µì‚¬:</strong> ì‹œí”„í‹° > ì¶œí‡´ê·¼ê¸°ë¡ > í•œë‹¬ì¹˜ ê·¼ë¬´ê¸°ë¡ ê²€ìƒ‰ > ì „ì²´ ë¦¬ìŠ¤íŠ¸ ë³µì‚¬<br>
                    <strong>2. ë¶™ì—¬ë„£ê¸°:</strong> ì•„ë˜ ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.<br>
                    <strong>3. íœ´ê°€ ì¶”ê°€:</strong> ë¦¬ìŠ¤íŠ¸ì— ì—†ëŠ” íœ´ê°€(ì—°ì°¨/ë°˜ì°¨)ëŠ” ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ ê·¼ë¬´ ì‹œê°„ìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="input-section">
            <h2 class="section-title">ğŸ“ ë°ì´í„° ì…ë ¥</h2>
            <div class="input-group">
                <label for="rawData">ğŸ” í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸°:</label>
                <textarea id="rawData" class="textarea-large" placeholder="11/25 (í™”)	09:44 - 18:37	09:44 - 18:30	(WM)BE1íŒ€(ê°œë°œ1ì‹¤)	3ì°¨ìŠ¹ì¸		67ë¶„	7ì‹œê°„ 46ë¶„	0ë¶„	0ë¶„	+ 7ë¶„
11/24 (ì›”)	09:17 - 18:35	09:17 - 18:35	(WM)BE1íŒ€(ê°œë°œ1ì‹¤)	3ì°¨ìŠ¹ì¸		65ë¶„	8ì‹œê°„ 13ë¶„	0ë¶„	0ë¶„	0ë¶„"></textarea>
            </div>
            <button class="btn-parse" onclick="startInitialCalculation()">ğŸ§  ê³„ì‚°</button>

            <div class="status-info">
                <strong>ğŸ“Š ë¶„ì„ ìƒíƒœ:</strong>
                <div id="currentStatus">ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
            </div>
            <div class="calendar-info">
                <strong>ğŸ“… ë‹¬ë ¥ ì •ë³´:</strong>
                <div id="calendarInfo">ë¡œë”© ì¤‘...</div>
            </div>

            <div class="input-group">
                <label>â• íœ´ê°€ ì‹œê°„ ì¶”ê°€ (ë‹¨ìˆœ í•©ì‚°):</label>
                <div class="leave-control-container">
                    <div class="leave-control">
                        <span>ì—°ì°¨ (+8ì‹œê°„)</span>
                        <div class="counter">
                            <button class="counter-btn" onclick="updateLeave('annual', -1)">-</button>
                            <span id="annualLeaveCount">0</span>
                            <button class="counter-btn" onclick="updateLeave('annual', 1)">+</button>
                        </div>
                    </div>
                    <div class="leave-control">
                        <span>ë°˜ì°¨ (+4ì‹œê°„)</span>
                        <div class="counter">
                            <button class="counter-btn" onclick="updateLeave('half', -1)">-</button>
                            <span id="halfLeaveCount">0</span>
                            <button class="counter-btn" onclick="updateLeave('half', 1)">+</button>
                        </div>
                    </div>
                    <div class="leave-control">
                        <span>ë°˜ë°˜ì°¨ (+2ì‹œê°„)</span>
                        <div class="counter">
                            <button class="counter-btn" onclick="updateLeave('quarter', -1)">-</button>
                            <span id="quarterLeaveCount">0</span>
                            <button class="counter-btn" onclick="updateLeave('quarter', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="result-section">
            <h2 class="section-title">âš¡ ê³„ì‚° ì„¤ì • (ìë™ ì…ë ¥)</h2>

            <div class="input-row">
                <div class="input-group">
                    <label>ğŸ• ì˜¤ëŠ˜ ì˜ˆì • ì‹œì‘:</label>
                    <input type="text" id="startTime" class="time-input editable-input auto-calc-indicator">
                </div>
                <div class="input-group">
                    <label>ğŸ•• ì˜¤ëŠ˜ ì˜ˆì • ì¢…ë£Œ:</label>
                    <input type="text" id="endTime" class="time-input editable-input auto-calc-indicator">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>ğŸ“… ë‚¨ì€ ê·¼ë¬´ì¼ìˆ˜ (ë‹¬ë ¥ ê¸°ì¤€):</label>
                    <input type="number" id="remainingDays" class="editable-input auto-calc-indicator" value="0" step="1">
                </div>
                <div class="input-group">
                    <label>â° í•˜ë£¨ ê¸°ë³¸ ê·¼ë¬´:</label>
                    <input type="text" id="dailyHours" class="time-input editable-input auto-calc-indicator" value="8:00">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>ğŸ“Š í˜„ì¬ ì¸ì • ì‹œê°„ (íœ´ê°€í¬í•¨):</label>
                    <input type="text" id="currentHours" class="time-input editable-input auto-calc-indicator" placeholder="0:00" readonly style="background:#eee!important; color:#333;">
                </div>
                <div class="input-group">
                    <label>ğŸ¯ ì´ë²ˆ ë‹¬ ëª©í‘œ ì‹œê°„:</label>
                    <input type="text" id="targetHours" class="time-input editable-input auto-calc-indicator" placeholder="160:00">
                </div>
            </div>

            <h2 class="section-title">ğŸ“Š ìµœì¢… ê²°ê³¼</h2>
            <table class="result-table">
                <thead><tr><th>í•­ëª©</th><th>ì‹œê°„</th></tr></thead>
                <tbody id="resultTableBody">
                <tr><td colspan="2" style="text-align:center;">ë°ì´í„° ì…ë ¥ í›„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // === ì„¤ì • ë° ìœ í‹¸ë¦¬í‹° ===
    let calculationTimeout = null;

    // 2025ë…„ ê³µíœ´ì¼
    const holidays2025 = [
        '2025-01-01', '2025-01-28', '2025-01-29', '2025-01-30', '2025-03-01',
        '2025-05-05', '2025-05-06', '2025-06-03', '2025-06-06', '2025-08-15',
        '2025-10-03', '2025-10-06', '2025-10-07', '2025-10-08', '2025-10-09', '2025-12-25, 2025-12-31'
    ];

    let leaveCounts = { annual: 0, half: 0, quarter: 0 };
    let parsedWorkHoursFromText = 0; // í…ìŠ¤íŠ¸ì—ì„œ íŒŒì‹±í•œ ìˆœìˆ˜ ê·¼ë¬´ ì‹œê°„

    function timeStringToHours(str) {
        if (!str) return 0;
        if (str.includes(':')) {
            const [h, m] = str.split(':').map(Number);
            return h + (m || 0) / 60;
        }
        return parseFloat(str) || 0;
    }

    function hoursToTimeString(hours) {
        if (isNaN(hours)) return '0:00';
        const sign = hours < 0 ? '-' : '';
        const abs = Math.abs(hours);
        const h = Math.floor(abs);
        const m = Math.round((abs - h) * 60);
        return `${sign}${h}:${m.toString().padStart(2, '0')}`;
    }

    function formatTimeWithDecimal(hours) {
        return `${hoursToTimeString(hours)} <span class="decimal-time">(${hours.toFixed(2)}h)</span>`;
    }

    // ë¶€ì¡±/ì´ˆê³¼ ì‹œê°„ì„ ìƒ‰ê¹”ê³¼ í•¨ê»˜ í¬ë§·íŒ…í•˜ëŠ” í•¨ìˆ˜
    function formatShortageWithStatus(diffHours) {
        const absHours = Math.abs(diffHours);
        const timeStr = hoursToTimeString(absHours);
        const decimalStr = `(${diffHours.toFixed(2)}h)`;

        if (diffHours < -0.01) {
            // ë¶€ì¡± (ëª©í‘œë³´ë‹¤ ì ìŒ) -> ë¹¨ê°„ìƒ‰
            return `<span class="shortage-text">â–¼ ${timeStr} ë¶€ì¡±</span> <span class="decimal-time">${decimalStr}</span>`;
        } else if (diffHours > 0.01) {
            // ì´ˆê³¼ (ëª©í‘œë³´ë‹¤ ë§ìŒ) -> ì´ˆë¡ìƒ‰
            return `<span class="excess-text">â–² ${timeStr} ì´ˆê³¼</span> <span class="decimal-time">${decimalStr}</span>`;
        } else {
            return `<span class="perfect-text">âœ¨ ë”± ë§ìŒ</span>`;
        }
    }

    function parseTimeInput(val) {
        if (!val) return '';
        val = val.replace(/[^0-9:]/g, '');
        if (!val.includes(':') && val.length >= 3) {
            return val.slice(0, -2) + ':' + val.slice(-2);
        }
        return val;
    }

    function formatDate(date) {
        return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
    }
    function isWorkingDay(date) {
        const day = date.getDay();
        if (day === 0 || day === 6) return false; // ì£¼ë§
        return !holidays2025.includes(formatDate(date)); // ê³µíœ´ì¼
    }

    function calculateMonthlyTargetHours() {
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth();
        const lastDay = new Date(year, month + 1, 0).getDate();
        let workDays = 0;

        for (let d = 1; d <= lastDay; d++) {
            if (isWorkingDay(new Date(year, month, d))) {
                workDays++;
            }
        }
        return workDays * 8;
    }

    function calculateRemainingDays() {
        const now = new Date();
        const todayDateOnly = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const lastDayOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);

        let remaining = 0;
        let total = 0;
        let passed = 0;

        for (let d = new Date(now.getFullYear(), now.getMonth(), 1); d <= lastDayOfMonth; d.setDate(d.getDate() + 1)) {
            const current = new Date(d);
            if (isWorkingDay(current)) {
                total++;
                if (current < todayDateOnly) passed++;
                else if (current > todayDateOnly) remaining++;
            }
        }
        return { total, passed, remaining, todayIsWorkDay: isWorkingDay(todayDateOnly) };
    }

    // === ë°ì´í„° íŒŒì‹± ===
    function parseData() {
        const rawText = document.getElementById('rawData').value;
        const lines = rawText.split('\n');

        let totalWorkedMinutes = 0;
        let parsedDaysCount = 0;
        let todayStart = '';
        let todayEnd = '';

        const today = new Date();
        const todayStr = `${today.getMonth() + 1}/${today.getDate()}`; // "11/26"

        const dateRegex = /(\d{1,2})\/(\d{1,2})/;
        const durationRegex = /(\d{1,2})ì‹œê°„\s*(\d{1,2})ë¶„/;

        lines.forEach(line => {
            const dateMatch = line.match(dateRegex);
            const durMatch = line.match(durationRegex);

            if (dateMatch) {
                const lineDateStr = `${dateMatch[1]}/${dateMatch[2]}`;
                const isToday = lineDateStr === todayStr;

                // 1. ì–´ì œê¹Œì§€ì˜ ê¸°ë¡ í•©ì‚°
                if (durMatch && !isToday) {
                    const h = parseInt(durMatch[1]);
                    const m = parseInt(durMatch[2]);
                    totalWorkedMinutes += (h * 60) + m;
                    parsedDaysCount++;
                }

                // 2. ì˜¤ëŠ˜ ë‚ ì§œ íŒŒì‹± (ëª¨ë“  ì‹œê°„ ì¶”ì¶œ -> ì²«/ë ì‚¬ìš©)
                if (isToday) {
                    const allTimes = line.match(/(\d{1,2}:\d{2})/g);
                    if (allTimes && allTimes.length >= 1) {
                        todayStart = allTimes[0];
                        if (allTimes.length >= 2) {
                            todayEnd = allTimes[allTimes.length - 1];
                        }
                    }
                }
            }
        });

        parsedWorkHoursFromText = totalWorkedMinutes / 60;

        document.getElementById('targetHours').value = hoursToTimeString(calculateMonthlyTargetHours());

        if (todayStart) document.getElementById('startTime').value = todayStart;
        if (todayEnd) document.getElementById('endTime').value = todayEnd;

        const daysInfo = calculateRemainingDays();
        document.getElementById('remainingDays').value = daysInfo.remaining;
        updateCalendarInfo(daysInfo);

        document.getElementById('currentStatus').innerHTML =
            `âœ… ${parsedDaysCount}ì¼ì¹˜ ê³¼ê±° ê¸°ë¡ ë¶„ì„ ì™„ë£Œ.`;

        calculateFromCurrentInputs();
    }

    // === ì‹¤ì‹œê°„ ê³„ì‚° ë¡œì§ ===
    function calculateFromCurrentInputs() {
        const indicator = document.querySelectorAll('.auto-calc-indicator');
        indicator.forEach(el => el.classList.add('calculating'));

        try {
            const startTimeStr = parseTimeInput(document.getElementById('startTime').value);
            const endTimeStr = parseTimeInput(document.getElementById('endTime').value);
            const monthlyTarget = timeStringToHours(document.getElementById('targetHours').value);
            const remainingDays = parseFloat(document.getElementById('remainingDays').value) || 0;
            const dailyBasic = timeStringToHours(document.getElementById('dailyHours').value);

            // íœ´ê°€ í•©ì‚°
            const leaveHours = (leaveCounts.annual * 8) + (leaveCounts.half * 4) + (leaveCounts.quarter * 2);
            const currentTotalRecognized = parsedWorkHoursFromText + leaveHours;
            document.getElementById('currentHours').value = hoursToTimeString(currentTotalRecognized);

            // ì˜¤ëŠ˜ ê·¼ë¬´ ì‹œê°„
            let todayWorked = 0;
            if (startTimeStr && endTimeStr) {
                const start = timeStringToHours(startTimeStr);
                const end = timeStringToHours(endTimeStr);
                if (end > start) {
                    let duration = end - start;
                    const ranges = [{s:12.5, e:13.5}, {s:18.5, e:19.5}];
                    let deduction = 0;
                    ranges.forEach(r => {
                        if (start < r.e && end > r.s) {
                            const overlap = Math.min(end, r.e) - Math.max(start, r.s);
                            deduction += Math.max(0, overlap);
                        }
                    });
                    todayWorked = Math.max(0, duration - deduction);
                }
            }

            // [ê³„ì‚° 1] ì˜¤ëŠ˜ í¬í•¨ í˜„ì¬ ëˆ„ì 
            const totalWithToday = currentTotalRecognized + todayWorked;
            const remainingTarget = monthlyTarget - totalWithToday;

            // [ê³„ì‚° 2] ê¶Œì¥ í•˜ë£¨ ê·¼ë¬´ì‹œê°„
            let neededPerDay = 0;
            if (remainingDays > 0) {
                neededPerDay = Math.max(0, remainingTarget / remainingDays);
            } else if (remainingTarget > 0) {
                neededPerDay = remainingTarget;
            }

            // [ê³„ì‚° 3] ê¸°ë³¸ ê·¼ë¬´(8H)ë¡œ ì­‰ í–ˆì„ ë•Œ ìµœì¢… ê²°ê³¼ (ë¶€ì¡±/ì´ˆê³¼)
            // (ì˜¤ëŠ˜ê¹Œì§€ í•œ ê²ƒ) + (ë‚¨ì€ ë‚  * ê¸°ë³¸ê·¼ë¬´)
            const predictedTotal = totalWithToday + (remainingDays * dailyBasic);
            const finalDifference = predictedTotal - monthlyTarget; // ìŒìˆ˜ë©´ ë¶€ì¡±, ì–‘ìˆ˜ë©´ ì´ˆê³¼

            const results = [
                ['â° ì˜¤ëŠ˜ ì˜ˆì • ê·¼ë¬´', formatTimeWithDecimal(todayWorked)],
                ['ğŸ“ˆ ì˜¤ëŠ˜ í¬í•¨ ì´ í•©ê³„', formatTimeWithDecimal(totalWithToday)],
                ['ğŸ¯ ë‚¨ì€ ëª©í‘œ ì‹œê°„', formatTimeWithDecimal(remainingTarget)],
                ['ğŸ“… ë‚¨ì€ ê·¼ë¬´ì¼ìˆ˜', `<span class="number-display">${remainingDays}ì¼</span>`],
                ['âš¡ ì•ìœ¼ë¡œ ë§¤ì¼ í•  ì‹œê°„', remainingDays > 0 ? formatTimeWithDecimal(neededPerDay) : "-"],
            ];

            const tbody = document.getElementById('resultTableBody');
            tbody.innerHTML = results.map(r => `<tr><td>${r[0]}</td><td class="time-display">${r[1]}</td></tr>`).join('');

            // â˜… í•˜ì´ë¼ì´íŠ¸ í–‰ ì¶”ê°€ (ê¸°ë³¸ì‹œê°„ ê·¼ë¬´ ì‹œ ìµœì¢… ê²°ê³¼)
            const highlightRow = document.createElement('tr');
            highlightRow.className = 'highlight-row';
            highlightRow.innerHTML = `
                <td>ğŸƒâ€â™‚ï¸ ë‚¨ì€ê¸°ê°„ ${document.getElementById('dailyHours').value} ê·¼ë¬´ì‹œ</td>
                <td>${formatShortageWithStatus(finalDifference)}</td>
            `;
            tbody.appendChild(highlightRow);

        } catch(e) {
            console.error(e);
        } finally {
            setTimeout(() => indicator.forEach(el => el.classList.remove('calculating')), 200);
        }
    }

    function startInitialCalculation() {
        leaveCounts = { annual: 0, half: 0, quarter: 0 };
        document.getElementById('annualLeaveCount').textContent = '0';
        document.getElementById('halfLeaveCount').textContent = '0';
        document.getElementById('quarterLeaveCount').textContent = '0';
        parseData();
    }

    function updateLeave(type, change) {
        const current = leaveCounts[type];
        if (current + change < 0) return;
        leaveCounts[type] += change;
        document.getElementById(`${type}LeaveCount`).textContent = leaveCounts[type];
        calculateFromCurrentInputs();
    }

    function updateCalendarInfo(info) {
        const div = document.getElementById('calendarInfo');
        div.innerHTML = `
            ì´ë²ˆ ë‹¬ ì´ í‰ì¼: ${info.total}ì¼ / ì§€ë‚œ í‰ì¼: ${info.passed}ì¼ / ë‚¨ì€ í‰ì¼: ${info.remaining}ì¼<br>
            ${info.todayIsWorkDay ? 'ì˜¤ëŠ˜ì€ ê·¼ë¬´ì¼ì…ë‹ˆë‹¤.' : 'ì˜¤ëŠ˜ì€ íœ´ì¼ì…ë‹ˆë‹¤.'}
        `;
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateCalendarInfo(calculateRemainingDays());

        document.getElementById('toggleHowToUse').addEventListener('click', function() {
            const content = document.getElementById('howToUseContent');
            const arrow = this.querySelector('.toggle-arrow');
            if (content.style.display === 'block') {
                content.style.display = 'none';
                arrow.textContent = 'â–¼';
            } else {
                content.style.display = 'block';
                arrow.textContent = 'â–²';
            }
        });

        document.querySelectorAll('.auto-calc-indicator').forEach(input => {
            input.addEventListener('input', () => {
                clearTimeout(calculationTimeout);
                calculationTimeout = setTimeout(calculateFromCurrentInputs, 500);
            });
            input.addEventListener('blur', function() {
                if (this.classList.contains('time-input')) this.value = parseTimeInput(this.value);
                calculateFromCurrentInputs();
            });
        });
    });
</script>
</body>
</html>
